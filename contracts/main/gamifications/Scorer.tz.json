{
  "text_code":
    "{ parameter (or (or (nat %buy) (nat %prepareBuy)) (nat %sell)) ;\n  storage\n    (pair (pair (pair (nat %current_rank) (nat %multiplier))\n                (pair (address %owner) (map %possible_ranks nat string)))\n          (pair (pair (nat %score) (address %score_token))\n                (pair (nat %streak) (address %trading_pair)))) ;\n  code { UNPAIR ;\n         IF_LEFT\n           { IF_LEFT\n               { SWAP ;\n                 DUP ;\n                 DUG 2 ;\n                 CDR ;\n                 CDR ;\n                 CDR ;\n                 CONTRACT %tezToTokenPayment (pair (nat %min_out) (address %receiver)) ;\n                 IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n                 PUSH mutez 1 ;\n                 DIG 2 ;\n                 MUL ;\n                 DUP 3 ;\n                 CAR ;\n                 CDR ;\n                 CAR ;\n                 PUSH nat 1 ;\n                 PAIR ;\n                 TRANSFER_TOKENS ;\n                 SWAP ;\n                 NIL operation ;\n                 DIG 2 ;\n                 CONS ;\n                 PAIR }\n               { NIL operation ;\n                 DUP 3 ;\n                 CDR ;\n                 CAR ;\n                 CDR ;\n                 CONTRACT %transfer (pair (address %from) (pair (address %to) (nat %value))) ;\n                 IF_NONE { PUSH string \"Dex/non-transferable\" ; FAILWITH } {} ;\n                 PUSH mutez 0 ;\n                 DUP 4 ;\n                 SELF_ADDRESS ;\n                 SENDER ;\n                 DUG 2 ;\n                 PAIR ;\n                 SWAP ;\n                 PAIR ;\n                 TRANSFER_TOKENS ;\n                 CONS ;\n                 DUP 3 ;\n                 CDR ;\n                 CAR ;\n                 CDR ;\n                 CONTRACT %approve (pair (address %spender) (nat %value)) ;\n                 IF_NONE { PUSH string \"Dex/non-approvable\" ; FAILWITH } {} ;\n                 PUSH mutez 0 ;\n                 DIG 3 ;\n                 DUP 5 ;\n                 CDR ;\n                 CDR ;\n                 CDR ;\n                 PAIR ;\n                 TRANSFER_TOKENS ;\n                 CONS ;\n                 PAIR } }\n           { SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             CDR ;\n             CDR ;\n             CONTRACT %tokenToTezPayment\n               (pair (pair (nat %amount) (nat %min_out)) (address %receiver)) ;\n             IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n             PUSH mutez 0 ;\n             DUP 4 ;\n             CAR ;\n             CDR ;\n             CAR ;\n             PUSH nat 1 ;\n             DIG 4 ;\n             PAIR ;\n             PAIR ;\n             TRANSFER_TOKENS ;\n             SWAP ;\n             NIL operation ;\n             DIG 2 ;\n             CONS ;\n             PAIR } } }"
}
