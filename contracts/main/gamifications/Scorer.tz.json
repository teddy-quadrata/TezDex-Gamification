{
  "text_code":
    "{ parameter\n    (or (or (or (nat %buy) (unit %default)) (or (unit %postSell) (nat %preSell))) (nat %sell)) ;\n  storage\n    (pair (pair (pair (pair (nat %current_rank) (address %level_token))\n                      (pair (nat %multiplier) (address %owner)))\n                (pair (pair (map %possible_ranks nat string) (nat %principal))\n                      (pair (nat %score) (address %score_token))))\n          (pair (nat %streak) (address %trading_pair))) ;\n  code { LAMBDA\n           (pair (pair address address) nat)\n           operation\n           { UNPAIR ;\n             UNPAIR ;\n             CONTRACT %mint (pair (address %target) (nat %value)) ;\n             IF_NONE { PUSH string \"Mint Score Entrypoint not Found\" ; FAILWITH } {} ;\n             PUSH mutez 0 ;\n             DIG 3 ;\n             DIG 3 ;\n             PAIR ;\n             TRANSFER_TOKENS } ;\n         DUP ;\n         LAMBDA\n           (pair (lambda (pair (pair address address) nat) operation)\n                 (pair (pair (pair (pair nat address) (pair nat address))\n                             (pair (pair (map nat string) nat) (pair nat address)))\n                       (pair nat address)))\n           (pair (list operation)\n                 (pair (pair (pair (pair nat address) (pair nat address))\n                             (pair (pair (map nat string) nat) (pair nat address)))\n                       (pair nat address)))\n           { UNPAIR ;\n             SWAP ;\n             PUSH string \"Sender isn't the dex\" ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             CDR ;\n             SENDER ;\n             COMPARE ;\n             EQ ;\n             IF { DROP } { FAILWITH } ;\n             PUSH mutez 1000000 ;\n             AMOUNT ;\n             EDIV ;\n             IF_NONE { PUSH string \"DIV by 0\" ; FAILWITH } {} ;\n             CAR ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CAR ;\n             CDR ;\n             CAR ;\n             CDR ;\n             SUB ;\n             ISNAT ;\n             IF_NONE { PUSH nat 1 } {} ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             DUP 3 ;\n             CAR ;\n             CDR ;\n             CDR ;\n             CDR ;\n             DUP 3 ;\n             DUP 5 ;\n             CAR ;\n             CDR ;\n             CDR ;\n             CAR ;\n             ADD ;\n             PAIR ;\n             DUP 4 ;\n             CAR ;\n             CDR ;\n             CAR ;\n             PAIR ;\n             DIG 3 ;\n             CAR ;\n             CAR ;\n             PAIR ;\n             PAIR ;\n             NIL operation ;\n             DUG 2 ;\n             DUP ;\n             DUG 3 ;\n             CAR ;\n             CAR ;\n             CDR ;\n             CDR ;\n             DUP 4 ;\n             CAR ;\n             CDR ;\n             CDR ;\n             CDR ;\n             PAIR ;\n             PAIR ;\n             DIG 3 ;\n             SWAP ;\n             EXEC ;\n             CONS ;\n             PAIR } ;\n         SWAP ;\n         APPLY ;\n         DIG 2 ;\n         UNPAIR ;\n         IF_LEFT\n           { IF_LEFT\n               { IF_LEFT\n                   { DIG 2 ;\n                     DROP ;\n                     SWAP ;\n                     DUP ;\n                     DUG 2 ;\n                     CDR ;\n                     CDR ;\n                     CONTRACT %tezToTokenPayment (pair (nat %min_out) (address %receiver)) ;\n                     IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n                     DUP 3 ;\n                     CDR ;\n                     DUP 4 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     CDR ;\n                     DUP 4 ;\n                     DUP 6 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     CAR ;\n                     ADD ;\n                     PAIR ;\n                     DUP 5 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     PAIR ;\n                     DIG 4 ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     DUP ;\n                     CDR ;\n                     SWAP ;\n                     DUP ;\n                     DUG 2 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     DUP 5 ;\n                     DUP 4 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CDR ;\n                     ADD ;\n                     DUP 4 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     DIG 2 ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     SWAP ;\n                     PUSH mutez 1 ;\n                     DUP 4 ;\n                     MUL ;\n                     DUP 3 ;\n                     CAR ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     PUSH nat 1 ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     NIL operation ;\n                     DIG 3 ;\n                     DUP 4 ;\n                     CAR ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     DUP 5 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     CDR ;\n                     PAIR ;\n                     PAIR ;\n                     DIG 4 ;\n                     SWAP ;\n                     EXEC ;\n                     CONS ;\n                     SWAP ;\n                     CONS ;\n                     PAIR }\n                   { DIG 3 ; DROP 2 ; EXEC } }\n               { DIG 3 ;\n                 DROP ;\n                 IF_LEFT\n                   { DROP ; EXEC }\n                   { DIG 2 ;\n                     DROP ;\n                     NIL operation ;\n                     DUP 3 ;\n                     CAR ;\n                     CAR ;\n                     CAR ;\n                     CDR ;\n                     CONTRACT %transfer (pair (address %from) (pair (address %to) (nat %value))) ;\n                     IF_NONE { PUSH string \"Dex/non-transferable\" ; FAILWITH } {} ;\n                     PUSH mutez 0 ;\n                     DUP 4 ;\n                     SELF_ADDRESS ;\n                     SENDER ;\n                     DUG 2 ;\n                     PAIR ;\n                     SWAP ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     CONS ;\n                     DUP 3 ;\n                     CAR ;\n                     CAR ;\n                     CAR ;\n                     CDR ;\n                     CONTRACT %approve (pair (address %spender) (nat %value)) ;\n                     IF_NONE { PUSH string \"Dex/non-approvable\" ; FAILWITH } {} ;\n                     PUSH mutez 0 ;\n                     DIG 3 ;\n                     DUP 5 ;\n                     CDR ;\n                     CDR ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     CONS ;\n                     PAIR } } }\n           { DIG 2 ;\n             DIG 3 ;\n             DROP 2 ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             CDR ;\n             CONTRACT %tokenToTezPayment\n               (pair (pair (nat %amount) (nat %min_out)) (address %receiver)) ;\n             IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n             SELF_ADDRESS ;\n             PUSH nat 1 ;\n             DIG 3 ;\n             PAIR ;\n             PAIR ;\n             SWAP ;\n             PUSH mutez 0 ;\n             DIG 2 ;\n             TRANSFER_TOKENS ;\n             SWAP ;\n             NIL operation ;\n             DIG 2 ;\n             CONS ;\n             PAIR } } }"
}
