{
  "text_code":
    "{ parameter\n    (or (or (or (nat %buy) (unit %default)) (or (unit %postSell) (nat %preSell))) (nat %sell)) ;\n  storage\n    (pair (pair (pair (pair (nat %current_rank) (nat %multiplier))\n                      (pair (address %owner) (map %possible_ranks nat string)))\n                (pair (pair (nat %principal) (nat %score)) (pair (address %score_token) (nat %streak))))\n          (address %trading_pair)) ;\n  code { LAMBDA\n           (pair (pair (pair (pair nat nat) (pair address (map nat string)))\n                       (pair (pair nat nat) (pair address nat)))\n                 address)\n           (pair (list operation)\n                 (pair (pair (pair (pair nat nat) (pair address (map nat string)))\n                             (pair (pair nat nat) (pair address nat)))\n                       address))\n           { PUSH string \"Sender isn't the dex\" ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             SENDER ;\n             COMPARE ;\n             EQ ;\n             IF { DROP } { FAILWITH } ;\n             NIL operation ;\n             PAIR } ;\n         SWAP ;\n         UNPAIR ;\n         IF_LEFT\n           { IF_LEFT\n               { IF_LEFT\n                   { DIG 2 ;\n                     DROP ;\n                     SWAP ;\n                     DUP ;\n                     DUG 2 ;\n                     CDR ;\n                     CONTRACT %tezToTokenPayment (pair (nat %min_out) (address %receiver)) ;\n                     IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n                     DUP 3 ;\n                     CDR ;\n                     DUP 4 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     DUP 4 ;\n                     DUP 6 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CDR ;\n                     ADD ;\n                     DUP 6 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     DIG 4 ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     DUP ;\n                     CDR ;\n                     SWAP ;\n                     DUP ;\n                     DUG 2 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     DUP 3 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CDR ;\n                     DUP 6 ;\n                     DUP 5 ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     CAR ;\n                     ADD ;\n                     PAIR ;\n                     PAIR ;\n                     DIG 2 ;\n                     CAR ;\n                     CAR ;\n                     PAIR ;\n                     PAIR ;\n                     SWAP ;\n                     PUSH mutez 1 ;\n                     DIG 3 ;\n                     MUL ;\n                     DUP 3 ;\n                     CAR ;\n                     CAR ;\n                     CDR ;\n                     CAR ;\n                     PUSH nat 1 ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     SWAP ;\n                     NIL operation ;\n                     DIG 2 ;\n                     CONS ;\n                     PAIR }\n                   { DROP ; EXEC } }\n               { IF_LEFT\n                   { DROP ; EXEC }\n                   { DIG 2 ;\n                     DROP ;\n                     NIL operation ;\n                     DUP 3 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     CAR ;\n                     CONTRACT %transfer (pair (address %from) (pair (address %to) (nat %value))) ;\n                     IF_NONE { PUSH string \"Dex/non-transferable\" ; FAILWITH } {} ;\n                     PUSH mutez 0 ;\n                     DUP 4 ;\n                     SELF_ADDRESS ;\n                     SENDER ;\n                     DUG 2 ;\n                     PAIR ;\n                     SWAP ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     CONS ;\n                     DUP 3 ;\n                     CAR ;\n                     CDR ;\n                     CDR ;\n                     CAR ;\n                     CONTRACT %approve (pair (address %spender) (nat %value)) ;\n                     IF_NONE { PUSH string \"Dex/non-approvable\" ; FAILWITH } {} ;\n                     PUSH mutez 0 ;\n                     DIG 3 ;\n                     DUP 5 ;\n                     CDR ;\n                     PAIR ;\n                     TRANSFER_TOKENS ;\n                     CONS ;\n                     PAIR } } }\n           { DIG 2 ;\n             DROP ;\n             SWAP ;\n             DUP ;\n             DUG 2 ;\n             CDR ;\n             CONTRACT %tokenToTezPayment\n               (pair (pair (nat %amount) (nat %min_out)) (address %receiver)) ;\n             IF_NONE { PUSH string \"Level not found\" ; FAILWITH } {} ;\n             SELF_ADDRESS ;\n             PUSH nat 1 ;\n             DIG 3 ;\n             PAIR ;\n             PAIR ;\n             SWAP ;\n             PUSH mutez 0 ;\n             DIG 2 ;\n             TRANSFER_TOKENS ;\n             NIL operation ;\n             SELF %postSell ;\n             PUSH mutez 0 ;\n             UNIT ;\n             TRANSFER_TOKENS ;\n             CONS ;\n             SWAP ;\n             CONS ;\n             PAIR } } }"
}
